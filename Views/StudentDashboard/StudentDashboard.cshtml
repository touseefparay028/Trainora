@{
    ViewData["Title"] = "Student Dashboard";
    Layout = "~/Views/Shared/StudentLayout.cshtml";
}
<style>
    .sidebar{
        padding-left:0;
        padding-right: 0;
    }
</style>

<div class="container-fluid">
    <div class="row">
        <!-- Sidebar -->
        <nav class="col-md-3 col-lg-2 collapse d-md-block bg-dark text-white sidebar vh-100 shadow" id="sidebarMenu">
            <div class="position-sticky pt-3">
                <h4 class="text-center mb-4 fw-bold text-success">Student Panel</h4>

                <ul class="nav flex-column">
                    <li class="nav-item mb-2">
                        <a class="nav-link text-white active" asp-action="StudentDashboard">
                            <i class="bi bi-speedometer2 me-2"></i> Dashboard
                        </a>
                    </li>
                    <li class="nav-item mb-2">
                        <a class="nav-link text-white" asp-action="MyCourses" asp-controller="Course">
                            <i class="bi bi-journal-bookmark me-2"></i> My Courses
                        </a>
                    </li>
                    <li class="nav-item mb-2">
                        <a class="nav-link text-white" asp-action="GetListAAsync" asp-controller="Student">
                            <i class="bi bi-pencil-square me-2"></i>Pending Assignments
                        </a>
                    </li>
                    <li class="nav-item mb-2">
                        <a class="nav-link text-white" asp-action="TakeQuiz" asp-controller="Student">
                            <i class="bi bi-clipboard-check me-2"></i> Quiz
                        </a>
                    </li>
                    @* <li class="nav-item mb-2">
                        <a class="nav-link text-white" asp-action="Results">
                            <i class="bi bi-bar-chart-line me-2"></i> Results
                        </a>
                    </li> *@
                    <li class="nav-item mb-2">
                        <a class="nav-link text-white" asp-action="Chat" asp-controller="BatchChat" asp-route-id="@ViewBag.batchid">
                            <i class="bi bi-person-check me-2"></i> Chat
                        </a>
                    </li>
                    <li class="nav-item mb-2">
                        <a class="nav-link text-white d-flex justify-content-between align-items-center"
                           asp-action="MyBatchConference" asp-controller="Student">
                            <span>
                                <i class="bi bi-person-check me-2"></i> Meetings
                            </span>
                            @if (ViewBag.MeetingCount != null && (int)ViewBag.MeetingCount > 0)
                            {
                                <span class="badge bg-danger rounded-pill">@ViewBag.MeetingCount</span>
                            }
                        </a>
                    </li>

                    <li class="nav-item mb-2">
                        <a class="nav-link text-white" asp-action="GetAnnouncements" asp-controller="Announcements">
                            <i class="bi bi-megaphone me-2"></i> College Notices
                        </a>
                    </li>
                    <li class="nav-item mb-2">
                        <a class="nav-link text-white" asp-action="GetMaterials" asp-controller="StudyMaterials">
                            <i class="bi bi-person-circle me-2"></i> Study Material
                        </a>
                    </li>
                    <li class="nav-item mb-2">
                        <a class="nav-link text-white" asp-action="Profile" asp-controller="Student">
                            <i class="bi bi-person-circle me-2"></i> Profile
                        </a>
                    </li>
                </ul>

                <hr class="text-secondary">

                @* <div class="text-center">
                    <a asp-action="Logout" asp-controller="Student" class="btn btn-sm btn-outline-light w-75">Logout</a>
                </div> *@
            </div>
        </nav>
      
        <!-- Main Content -->
        <main class="col-md-9  col-lg-10 px-md-4 py-4">
            <h2 class="fw-bold text-success mb-4">
                <i class="bi bi-speedometer2"></i> Welcome, @ViewBag.Name
            </h2>

            <!-- Stats Section -->
            <div class="row mb-4">
                <div class="col-md-3">
                    <div class="card shadow rounded-4 border-0">
                        <div class="card-body text-center">
                            <i class="bi bi-journal-bookmark text-success fs-2"></i>
                            <h5 class="mt-2">Courses</h5>
                            <p class="fw-bold">@ViewBag.enrolledCount Enrolled</p>
                        </div>
                    </div>
                </div>
                <div class="col-md-3">
                    <div class="card shadow rounded-4 border-0">
                        <div class="card-body text-center">
                            <i class="bi bi-pencil-square text-primary fs-2"></i>
                            <h5 class="mt-2">Assignments</h5>
                            <p class="fw-bold">@ViewBag.CountOfAssignments Pending</p>
                        </div>
                    </div>
                </div>
                @* <div class="col-md-3">
                    <div class="card shadow rounded-4 border-0">
                        <div class="card-body text-center">
                            <i class="bi bi-clipboard-check text-warning fs-2"></i>
                            <h5 class="mt-2">Quiz</h5>
                        </div>
                    </div>
                </div> *@
                @* <div class="col-md-3">
                    <div class="card shadow rounded-4 border-0">
                        <div class="card-body text-center">
                            <i class="bi bi-bar-chart-line text-danger fs-2"></i>
                            <h5 class="mt-2">Results</h5>
                            <p class="fw-bold">View</p>
                        </div>
                    </div>
                </div> *@
            </div>
            <div class="row g-3">
                <!-- Single row container with some gap -->
                <!-- Latest College Notices -->
                <div class="col-md-6">
                    <div class="card shadow rounded-4 border-0 h-100">
                        <div class="card-header bg-success text-white rounded-top-4">
                            <h5 class="mb-0">Latest College Notices</h5>
                        </div>
                        <div class="card-body" style="max-height: 300px; overflow-y: auto;">
                            <ul class="list-group list-group-flush">
                                @if (ViewBag.Announcements != null && ViewBag.Announcements.Count > 0)
                                {
                                    foreach (var ann in ViewBag.Announcements)
                                    {
                                        bool isNew = (DateTime.Now - ann.CreatedAt).TotalHours <= 24;
                                        <li class="list-group-item d-flex justify-content-between align-items-center">
                                            <div>
                                                @if (!string.IsNullOrEmpty(ann.FilePath))
                                                {
                                                    <a asp-action="ViewAnnouncement" asp-controller="Announcements" asp-route-FilePath="@ann.FilePath" class="fw-semibold text-dark text-decoration-none">
                                                        @ann.Description
                                                    </a>
                                                }
                                                else
                                                {
                                                    <span class="fw-semibold">@ann.Description</span>
                                                }
                                                <br />
                                                <small class="text-muted">@ann.CreatedAt.ToString("dd MMM yyyy, hh:mm tt")</small>
                                            </div>

                                            @if (isNew)
                                            {
                                                <span class="badge bg-danger rounded-pill">NEW</span>
                                            }
                                        </li>
                                    }
                                }
                                else
                                {
                                    <li class="list-group-item text-muted">No announcements yet.</li>
                                }
                            </ul>
                        </div>
                    </div>
                </div>

                <!-- Available Courses -->
                <div class="col-md-6">
                    <div class="card shadow rounded-4 border-0 h-100">
                        <div class="card-header bg-success text-white rounded-top-4">
                            <h5 class="mb-0">Available Courses</h5>
                        </div>
                        <div class="card-body" style="max-height: 300px; overflow-y: auto; position: relative;">
                            <table class="table table-sm mb-0">
                                <thead>
                                    <tr>
                                        <th>Course</th>
                                        <th>Description</th>
                                        <th>Teacher</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    @if (ViewBag.FewCourses != null)
                                    {
                                        foreach (var course in ViewBag.FewCourses)
                                        {
                                            <tr>
                                                <td>@course.Title</td>
                                                <td>@course.Description</td>
                                                <td>@course.Teacher.Name</td>
                                            </tr>
                                        }
                                    }
                                    else
                                    {
                                        <tr>
                                            <td colspan="3" class="text-muted">No courses available.</td>
                                        </tr>
                                    }
                                </tbody>
                            </table>

                            <!-- View All button -->
                            <a href="@Url.Action("ExploreCourses", "Course")"
                               class="btn btn-link position-absolute bottom-0 end-0 m-2">
                                View All
                            </a>
                        </div>
                    </div>
                </div>
            </div>
